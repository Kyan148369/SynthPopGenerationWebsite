<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Ensures proper rendering and touch zooming for all devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synthetic Population Generator</title>
    <!-- Link to Bootstrap CSS for styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Hide result card and request status by default */
        .result-card, #requestStatus {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Main container with top margin -->
    <div class="container mt-5">
        <!-- Page title -->
        <h1 class="mb-4">Synthetic Population Generator</h1>
        <!-- Form for user input -->
        <form id="populationForm">
            <!-- Region dropdown -->
            <div class="mb-3">
                <label for="region" class="form-label">Region</label>
                <select class="form-select" id="region" required>
                    <option value="">Select a region</option>
                    <option value="north">North</option>
                    <option value="south">South</option>
                    <option value="east">East</option>
                    <option value="west">West</option>
                </select>
            </div>
            <!-- Census Year dropdown -->
            <div class="mb-3">
                <label for="year" class="form-label">Census Year</label>
                <select class="form-select" id="year" required>
                    <option value="">Select a year</option>
                    <option value="2020">2020</option>
                    <option value="2021">2021</option>
                    <option value="2022">2022</option>
                    <option value="2023">2023</option>
                </select>
            </div>
            <!-- Population Range dropdown -->
            <div class="mb-3">
                <label for="population" class="form-label">Population Range</label>
                <select class="form-select" id="population" required>
                    <option value="">Select a population range</option>
                    <option value="0-1000">0 - 1,000</option>
                    <option value="1001-10000">1,001 - 10,000</option>
                    <option value="10001-100000">10,001 - 100,000</option>
                    <option value="100001-1000000">100,001 - 1,000,000</option>
                </select>
            </div>
            <!-- Email input field -->
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" required>
            </div>
            <!-- Submit button -->
            <button type="submit" class="btn btn-primary">Request Data</button>
        </form>

        <!-- Request status display (hidden by default) -->
        <div id="requestStatus" class="mt-4 alert alert-info">
            <p>Status: <span id="status"></span></p>
            <p>Estimated time: <span id="estimatedTime"></span></p>
        </div>

        <!-- Results display (hidden by default) -->
        <div id="result" class="mt-4 result-card">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Results</h5>
                    <p class="card-text">Synthetic Population: <span id="syntheticPopulation"></span></p>
                    <p class="card-text">Verification Score: <span id="verificationScore"></span>%</p>
                </div>
            </div>
        </div>

        <!-- Error message display (hidden by default) -->
        <div id="error" class="mt-4 alert alert-danger" style="display: none;"></div>
    </div>

    <!-- Link to Bootstrap JavaScript bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Add event listener to the form submission
        document.getElementById('populationForm').addEventListener('submit', async function(e) {
            e.preventDefault(); // Prevent default form submission
            // Get form values
            const region = document.getElementById('region').value;
            const year = document.getElementById('year').value;
            const population = document.getElementById('population').value;
            const email = document.getElementById('email').value;

            const requestData = {region,year,population,email};
            console.log('Sending data:', requestData)

            try {
                console.log('Sending request to server...');
                // Send POST request to the server
                const response = await fetch('/api/request', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData),
                });

                console.log('Received response from server', response.status, response.statusText);

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const responseData = await response.json();
                console.log('Parsed response data:', responseData);

                if (responseData.status === 'ready') {
                    // If data is ready, display results
                    document.getElementById('syntheticPopulation').textContent = responseData.syntheticPopulation;
                    document.getElementById('verificationScore').textContent = responseData.verificationScore;
                    document.getElementById('result').style.display = 'block';
                    document.getElementById('requestStatus').style.display = 'none';
                } else {
                    // If data is processing, display status
                    document.getElementById('status').textContent = responseData.status;
                    document.getElementById('estimatedTime').textContent = responseData.estimatedTime;
                    document.getElementById('requestStatus').style.display = 'block';
                    document.getElementById('result').style.display = 'none';
                }

                // Hide error message
                document.getElementById('error').style.display = 'none';
            } catch (error) {
                // Display error message if something goes wrong
                console.error('Error details:', error);
                document.getElementById('error').textContent = 'An error occurred while processing your request.';
                document.getElementById('error').style.display = 'block';
                document.getElementById('result').style.display = 'none';
                document.getElementById('requestStatus').style.display = 'none';
            }
        });
    </script>
</body>
</html>
